<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ошибка {{ error_code }} - Городской гид</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="icon" href="{{ url_for('static', filename='Фотки зданий/лого.png') }}" type="image/png">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/Error.css') }}">
</head>
<body>
<!-- Объединенная навигация -->
<nav class="navbar">
    <div class="nav-container">
        <div class="logo" onclick="window.location.href='/';">
            <img src="{{ url_for('static', filename='Фотки зданий/лого.png') }}" alt="Логотип" height="50px" width="70px">
            <span>Городской Гид</span>
        </div>

        <!-- Поиск из старого HTML с визуалом нового -->
        <form class="search-box" action="/search" method="POST">
            <input type="text" name="query" placeholder="Поиск заведений..." class="search-input" id="search-input">
            <button type="submit" class="search-button">
                <svg class="search-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M11 19C15.4183 19 19 15.4183 19 11C19 6.58172 15.4183 3 11 3C6.58172 3 3 6.58172 3 11C3 15.4183 6.58172 19 11 19Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M21 21L16.65 16.65" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>
        </form>

        <!-- Кнопка избранного из старого HTML -->
        <div class="favorites-wrapper">
            <div class="favorite-wrapper" id="header-favorites-btn" style="display: none;" onclick="window.location.href='/favorites'">
              <span class="particle particle-1">✦</span>
              <span class="particle particle-2">✦</span>
              <span class="particle particle-3">✦</span>
              <span class="particle particle-4">✦</span>
              <span class="particle particle-5">✦</span>
              <span class="particle particle-6">✦</span>
              <span class="particle particle-7">✦</span>
              <span class="heart-icon">❤</span>
              <span class="favorites-counter" id="favorites-count">0</span>
            </div>
        </div>

        <!-- Кнопки входа/регистрации из старого HTML с визуалом нового -->
        <div class="auth-buttons">
            <button id="loginButton" class="btn-login" onclick="showWindow()">Вход</button>
            <button id="registerButton" class="btn-register" onclick="showWindow1()">Регистрация</button>
            <div id="userInfo" style="display: none;">
                <div class="btn-admin" id="adminButton" onclick="window.location.href='/admin'">
                    <img id="avatar" src="{{ url_for('static', filename='Фотки зданий/avatar.png') }}" alt="Avatar">
                    <span id="welcomeUser"></span>
                </div>
                <button class="btn-logout" onclick="logout()">Выход</button>
            </div>
        </div>
    </div>
    <div class="clouds"></div>
</nav>

<!-- Окна входа/регистрации из HTML 1 -->
    <div id="overlay" style="display: none;"></div>

    <div id="content_window" class="popup-window">
        <form id="loginForm" method="POST" action="/login">
            <h1 style="color: black">Вход</h1>
            <span class="btnX" onclick="hideWindow()">×</span>
            <div class="form-group">
                <label style="color: black" for="username">Логин</label>
                <input type="text" class="form-control" id="username" name="username" required>
            </div>
            <div class="form-group">
                <label style="color: black" for="password">Пароль</label>
                <input type="password" class="form-control" id="password" name="password" required>
            </div>
            <button type="submit" class="btnA">Войти</button>
        </form>
    </div>

    <div id="content_window2" class="popup-window">
        <form id="regForm" method="POST" action="/register">
            <h1 style="color: black">Регистрация</h1>
            <span class="btnX" onclick="hideWindow1()">×</span>
            <div class="form-group">
                <label style="color: black" for="username1">Логин</label>
                <input type="text" id="username1" name="username" class="form-control" required>
            </div>
            <div class="form-group">
                <label style="color: black" for="password1">Пароль</label>
                <input type="password" id="password1" name="password" class="form-control" required>
            </div>
            <div class="form-group">
                <label style="color: black" for="password2">Подтвердите пароль</label>
                <input type="password" id="password2" name="confirm_password" class="form-control" required>
            </div>
            <div class="form-group">
                <label style="color: black" for="secret_key">Секретный ключ</label>
                <input type="password" id="secret_key" name="secret_key" class="form-control" required>
            </div>
            <button type="submit" class="btnB">Зарегистрироваться</button>
        </form>
    </div>

<!-- Объемный дождь на всей странице -->
<div class="rain-overlay" id="rainOverlay"></div>

<!-- Фоновое изображение -->
<div class="error-page">
    <div class="background-container">
        <img class="background-img" src="{{ url_for('static', filename='Фотки зданий/404.png') }}" alt="Фон ошибки">
    </div>

    <div class="error-container">
        <!-- Кружок с вопросом -->
        <div class="help-circle" id="helpCircle">?</div>

        <!-- Всплывающая подсказка -->
        <div class="help-tooltip" id="helpTooltip">
            <h4>Что можно сделать:</h4>
            <ul>
                {% if error_code == 404 %}
                <li>Проверьте правильность введенного URL адреса</li>
                <li>Вернитесь на предыдущую страницу</li>
                <li>Воспользуйтесь поиском по сайту</li>
                {% elif error_code == 500 %}
                <li>Обновите страницу через несколько минут</li>
                <li>Попробуйте очистить кэш браузера</li>
                <li>Если проблема сохраняется, свяжитесь с поддержкой</li>
                {% elif error_code == 403 %}
                <li>Проверьте свои права доступа</li>
                <li>Войдите в систему, если требуется авторизация</li>
                {% elif error_code == 429 %}
                <li>Подождите несколько минут перед повторной попыткой</li>
                <li>Уменьшите частоту запросов</li>
                {% else %}
                <li>Обновите страницу</li>
                <li>Вернитесь на главную страницу</li>
                <li>Проверьте подключение к интернету</li>
                {% endif %}
            </ul>
        </div>

        <div class="error-code">{{ error_code }}</div>
        <div class="error-name">{{ error_name }}</div>
    </div>
</div>

    <!-- Вставляем подвал -->
    {% include 'footer.html' %}

    <!-- Подключаем общий JS -->
    <script src="{{ url_for('static', filename='js/common.js') }}"></script>
    <script>
// Инициализация при загрузке страницы
document.addEventListener('DOMContentLoaded', function() {
    // Добавляем класс для тела страницы
    document.body.classList.add('error-page');

    // Обработчик для кнопки помощи
    const helpCircle = document.getElementById('helpCircle');
    const helpTooltip = document.getElementById('helpTooltip');

    if (helpCircle && helpTooltip) {
        helpCircle.addEventListener('click', function() {
            helpTooltip.classList.toggle('show');
        });

        // Закрытие подсказки при клике вне ее
        document.addEventListener('click', function(event) {
            if (!helpCircle.contains(event.target) && !helpTooltip.contains(event.target)) {
                helpTooltip.classList.remove('show');
            }
        });
    }
});

    // Управление подсказкой
    const helpCircle = document.getElementById('helpCircle');
    const helpTooltip = document.getElementById('helpTooltip');

    helpCircle.addEventListener('click', function(e) {
        e.stopPropagation();
        helpTooltip.classList.toggle('show');
    });

    // Закрытие подсказки при клике вне её
    document.addEventListener('click', function(e) {
        if (!helpTooltip.contains(e.target) && e.target !== helpCircle) {
            helpTooltip.classList.remove('show');
        }
    });

    // Предотвращаем закрытие при клике на саму подсказку
    helpTooltip.addEventListener('click', function(e) {
        e.stopPropagation();
    });

    function logout() {
        console.log('Выход из системы');
    }

    // Динамическое обновление таймера для ошибки 429
    document.addEventListener('DOMContentLoaded', function() {
        const errorCode = {{ error_code }};

        if (errorCode === 429) {
            let countdown = 300;
            const countdownElement = document.createElement('div');
            countdownElement.className = 'countdown mt-3';
            countdownElement.innerHTML = `<strong>Повторная попытка через: <span id="countdown-timer">05:00</span></strong>`;
            document.querySelector('.error-content').appendChild(countdownElement);

            const timerElement = document.getElementById('countdown-timer');
            const interval = setInterval(() => {
                countdown--;
                const minutes = Math.floor(countdown / 60);
                const seconds = countdown % 60;
                timerElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;

                if (countdown <= 0) {
                    clearInterval(interval);
                    timerElement.textContent = 'Можно пробовать снова!';
                    timerElement.style.color = '#2ed573';
                }
            }, 1000);
        }
    });

        // Создаем объемный дождь на всей странице
    function createRain() {
        const rainOverlay = document.getElementById('rainOverlay');
        const dropsCount = 150; // Увеличиваем количество капель

        // Очищаем предыдущие капли
        rainOverlay.innerHTML = '';

        for (let i = 0; i < dropsCount; i++) {
            const drop = document.createElement('div');
            drop.className = 'rain-drop';

            // Случайные параметры для объема
            const left = Math.random() * 100;
            const height = 30 + Math.random() * 70;
            const delay = Math.random() * 5;
            const duration = 1 + Math.random() * 2;
            const opacity = 0.3 + Math.random() * 0.5;

            drop.style.left = left + '%';
            drop.style.height = height + 'px';
            drop.style.animationDelay = delay + 's';
            drop.style.animationDuration = duration + 's';
            drop.style.opacity = opacity;

            rainOverlay.appendChild(drop);
        }
    }

    helpCircle.addEventListener('click', function(e) {
        e.stopPropagation();
        helpTooltip.classList.toggle('show');
    });

    // Закрытие подсказки при клике вне её
    document.addEventListener('click', function() {
        helpTooltip.classList.remove('show');
    });

    // Предотвращаем закрытие при клике на саму подсказку
    helpTooltip.addEventListener('click', function(e) {
        e.stopPropagation();
    });

    // Создаем дождь при загрузке страницы и обновляем каждые 10 секунд
    document.addEventListener('DOMContentLoaded', function() {
        createRain();
    });

    // Обновленная функция для подсказки
    function initHelpTooltip() {
        const helpCircle = document.getElementById('helpCircle');
        const helpTooltip = document.getElementById('helpTooltip');

        if (!helpCircle || !helpTooltip) return;

        helpCircle.addEventListener('click', function(e) {
            e.stopPropagation();
            helpTooltip.classList.toggle('show');
        });

        // Закрытие подсказки при клике вне её
        document.addEventListener('click', function(e) {
            if (!helpTooltip.contains(e.target) && e.target !== helpCircle) {
                helpTooltip.classList.remove('show');
            }
        });

        // Предотвращаем закрытие при клике на саму подсказку
        helpTooltip.addEventListener('click', function(e) {
            e.stopPropagation();
        });
    }

    // Инициализация при загрузке
    document.addEventListener('DOMContentLoaded', function() {
        initHelpTooltip();
    });

    helpCircle.addEventListener('click', function(e) {
        e.stopPropagation();
        helpTooltip.classList.toggle('show');
    });

    // Закрытие подсказки при клике вне её
    document.addEventListener('click', function() {
        helpTooltip.classList.remove('show');
    });

    // Предотвращаем закрытие при клике на саму подсказку
    helpTooltip.addEventListener('click', function(e) {
        e.stopPropagation();
    });

    // Динамическое обновление таймера для ошибки 429
    document.addEventListener('DOMContentLoaded', function() {
        const errorCode = {{ error_code }};

        if (errorCode === 429) {
            let countdown = 300;
            const countdownElement = document.createElement('div');
            countdownElement.className = 'countdown mt-3';
            countdownElement.innerHTML = `<strong>Повторная попытка через: <span id="countdown-timer">05:00</span></strong>`;
            document.querySelector('.error-content').appendChild(countdownElement);

            const timerElement = document.getElementById('countdown-timer');
            const interval = setInterval(() => {
                countdown--;
                const minutes = Math.floor(countdown / 60);
                const seconds = countdown % 60;
                timerElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;

                if (countdown <= 0) {
                    clearInterval(interval);
                    timerElement.textContent = 'Можно пробовать снова!';
                    timerElement.style.color = '#2ed573';
                }
            }, 1000);
        }
    });
</script>
</body>
</html>