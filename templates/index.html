<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{title}}</title>
    <link href="{{ url_for('static', filename='css/bootstrap.min.css') }}" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/index.css') }}">
    <link rel="icon" href="{{ url_for('static', filename='Фотки зданий/лого.png') }}" type="image/png">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <!-- Навигация с функционалом из HTML 1 и стилями из HTML 2 -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo">
                <img src="{{ url_for('static', filename='Фотки зданий/лого.png') }}" alt="Логотип">
                <span>Городской Гид</span>
            </div>

            <!-- Поиск из HTML 1 -->
            <form class="search-box" action="/search" method="POST">
                <input type="text" name="query" placeholder="Поиск заведений..." class="search-input">
                <button type="submit" class="search-button">
                    <svg class="search-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M11 19C15.4183 19 19 15.4183 19 11C19 6.58172 15.4183 3 11 3C6.58172 3 3 6.58172 3 11C3 15.4183 6.58172 19 11 19Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M21 21L16.65 16.65" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
            </form>

            <!-- Кнопки входа/регистрации из HTML 1 -->
            <div class="auth-buttons">
                <button id="loginButton" class="btn-login">Вход</button>
                <button id="registerButton" class="btn-register">Регистрация</button>
                <div id="userInfo" style="display: none;">
                    <div class="box">
                        <img id="avatar" src="{{ url_for('static', filename='Фотки зданий/avatar.png') }}" alt="Avatar">
                        <span id="welcomeUser"></span>
                    </div>
                    <button class="btn-logout">Выход</button>
                </div>
            </div>
        </div>
        <div class="clouds"></div>
    </nav>

    <!-- Окна входа/регистрации из HTML 1 -->
    <div id="overlay" style="display: none;"></div>

    <div id="content_window" class="popup-window">
        <form id="loginForm" method="POST" action="/login">
            <h1>Вход</h1>
            <span class="btnX" onclick="hideWindow()">×</span>
            <div class="form-group">
                <label for="username">Логин</label>
                <input type="text" class="form-control" id="username" name="username" required>
            </div>
            <div class="form-group">
                <label for="password">Пароль</label>
                <input type="password" class="form-control" id="password" name="password" required>
            </div>
            <button type="submit" class="btnA">Войти</button>
        </form>
    </div>

    <div id="content_window2" class="popup-window">
        <form id="regForm" method="POST" action="/register">
            <h1>Регистрация</h1>
            <span class="btnX" onclick="hideWindow1()">×</span>
            <div class="form-group">
                <label for="username1">Логин</label>
                <input type="text" id="username1" name="username" class="form-control" required>
            </div>
            <div class="form-group">
                <label for="password1">Пароль</label>
                <input type="password" id="password1" name="password" class="form-control" required>
            </div>
            <div class="form-group">
                <label for="password2">Подтвердите пароль</label>
                <input type="password" id="password2" name="confirm_password" class="form-control" required>
            </div>
            <div class="form-group">
                <label for="secret_key">Секретный ключ</label>
                <input type="password" id="secret_key" name="secret_key" class="form-control" required>
            </div>
            <button type="submit" class="btnB">Зарегистрироваться</button>
        </form>
    </div>

    <!--Основное содержимое из HTML 2 -->
    <main>
        <!-- Герой-секция -->
        <section class="hero">
            <div class="hero-content">
                <h1>Откройте для себя Великий Новгород</h1>
                <p>Найдите лучшие места города в одном гиде</p>
                <button class="btn-explore Menu">Начать исследовать</button>
            </div>
            <img src="{{ url_for('static', filename='Фотки зданий/ВеликийНовгород.png') }}" alt="Великий Новгород" class="hero-image">
        </section>

        <!-- Категории -->
        <section class="categories">
            <div class="container">
                <h2>Выберите категорию</h2>
                <div class="category-grid">
                    <!-- Ряд 1 -->
                    <div class="category-card" onclick="window.location.href='/Restaurant'">
                        <div class="icon-wrapper">
                            <img src="{{ url_for('static', filename='Фотки зданий/ИконкаРесторана.png') }}" alt="Рестораны">
                        </div>
                    </div>

                    <div class="category-card" onclick="window.location.href='/Coffee'">
                        <div class="icon-wrapper">
                            <img src="{{ url_for('static', filename='Фотки зданий/ИконкаКофе.png') }}" alt="Кафе">
                        </div>
                    </div>

                    <div class="category-card" onclick="window.location.href='/shop'">
                        <div class="icon-wrapper">
                            <img src="{{ url_for('static', filename='Фотки зданий/ИконкаМагазина.png') }}" alt="Магазины">
                        </div>
                    </div>

                    <!-- Ряд 2 -->
                    <div class="category-card" onclick="window.location.href='/museums'">
                        <div class="icon-wrapper">
                            <img src="{{ url_for('static', filename='Фотки зданий/ИконкаМузеи.png') }}" alt="Музеи">
                        </div>
                    </div>

                    <div class="category-card" onclick="window.location.href='/theatre'">
                        <div class="icon-wrapper">
                            <img src="{{ url_for('static', filename='Фотки зданий/ИконкаТеатр.png') }}" alt="Театры">
                        </div>
                    </div>

                    <div class="category-card" onclick="window.location.href='/library'">
                        <div class="icon-wrapper">
                            <img src="{{ url_for('static', filename='Фотки зданий/ИконкиБиблиотеки.png') }}" alt="Библиотеки">
                        </div>
                    </div>

                    <!-- Ряд 3 -->
                    <div class="category-card" onclick="window.location.href='/park'">
                        <div class="icon-wrapper">
                            <img src="{{ url_for('static', filename='Фотки зданий/ИконкаПарка.png') }}" alt="Парки">
                        </div>
                    </div>

                    <div class="category-card" onclick="window.location.href='/cinema'">
                        <div class="icon-wrapper">
                            <img src="{{ url_for('static', filename='Фотки зданий/ИконкаКинотеатр.png') }}" alt="Кинотеатры">
                        </div>
                    </div>

                    <div class="category-card" onclick="window.location.href='/sports'">
                        <div class="icon-wrapper">
                            <img src="{{ url_for('static', filename='Фотки зданий/ИконкаСпортплощадка.png') }}" alt="Спорт">
                        </div>
                    </div>

                    <!-- Дополнительные категории -->
                    <div class="category-card" onclick="window.location.href='/church'">
                        <div class="icon-wrapper">
                            <img src="{{ url_for('static', filename='Фотки зданий/ИконкаЦеркви.png') }}" alt="Церкви">
                        </div>
                    </div>

                    <div class="category-card" onclick="window.location.href='/hotels'">
                        <div class="icon-wrapper">
                            <img src="{{ url_for('static', filename='Фотки зданий/ИконкиГостиницы.png') }}" alt="Гостиницы">
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

 <!-- Городской силуэт перед футером -->
    <div class="skyscrapers"></div>

    <!-- Футер -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section about">
                <img src="{{ url_for('static', filename='Фотки зданий/лого.png') }}" style="width: 120px;" alt="Логотип">
                <p>Городской гид - ваш путеводитель по лучшим местам Великого Новгорода</p>
                <div class="socials">
                    <a href="#"><img src="{{ url_for('static', filename='Фотки зданий/TG.png') }}" alt="Telegram"></a>
                    <a href="#"><img src="{{ url_for('static', filename='Фотки зданий/YT.png') }}" style="margin-bottom: 0; margin-top: 8px" alt="YouTube"></a>
                    <a href="#"><img src="{{ url_for('static', filename='Фотки зданий/vk.png') }}" alt="VK"></a>
                    <a href="#"><img src="{{ url_for('static', filename='Фотки зданий/OK.png') }}" alt="OK"></a>
                </div>
            </div>

            <div class="footer-section links">
                <h3>Навигация</h3>
                <ul>
                    <li><a href="#">Главная</a></li>
                    <li><a href="#">О проекте</a></li>
                    <li><a href="#">Контакты</a></li>
                    <li><a href="#">Помощь</a></li>
                </ul>
            </div>

            <div class="footer-section contact">
                <h3>Контакты</h3>
                <p><i class="phone-icon"></i> +7 (123) 456-78-90</p>
                <p><i class="email-icon"></i> info@gorodskoygid.ru</p>
                <p><i class="location-icon"></i> Великий Новгород</p>
            </div>
        </div>

        <div class="footer-bottom">
            &copy; 2025 Городской Гид | Все права защищены
        </div>
    </footer>

    <!-- Подключение локального Bootstrap JS -->
    <script src="{{ url_for('static', filename='js/bootstrap.bundle.min.js') }}"></script>

    <!-- Скрипты из HTML 1 -->
    <script>
        function showWindow() {
            document.getElementById('overlay').style.display = 'block';
            const windowElement = document.getElementById('content_window');
            windowElement.classList.add('show');
            windowElement.style.display = 'block';
        }

        function hideWindow() {
            document.getElementById('overlay').style.display = 'none';
            const windowElement = document.getElementById('content_window');
            windowElement.classList.remove('show');
            windowElement.style.display = 'none';
            document.body.classList.remove('no-scroll');
        }

        function showWindow1() {
            document.getElementById('overlay').style.display = 'block';
            const windowElement = document.getElementById('content_window2');
            windowElement.classList.add('show');
            windowElement.style.display = 'block';
        }

        function hideWindow1() {
            document.getElementById('overlay').style.display = 'none';
            const windowElement = document.getElementById('content_window2');
            windowElement.classList.remove('show');
            windowElement.style.display = 'none';
            document.body.classList.remove('no-scroll');
        }

        // Закрытие окна при клике вне его
        document.getElementById('overlay').addEventListener('click', function() {
            const window1 = document.getElementById('content_window');
            const window2 = document.getElementById('content_window2');
            if (window1.classList.contains('show')) {
                hideWindow();
            } else if (window2.classList.contains('show')) {
                hideWindow1();
            }
        });

        // Обработчики кнопок входа/регистрации
        document.getElementById('loginButton').addEventListener('click', showWindow);
        document.getElementById('registerButton').addEventListener('click', showWindow1);

        // Обработчик для формы регистрации
        document.getElementById('regForm').onsubmit = function(event) {
            event.preventDefault();

            const username = document.getElementById('username1').value;
            const password = document.getElementById('password1').value;
            const confirmPassword = document.getElementById('password2').value;
            const secretKey = document.getElementById('secret_key').value;

            if (password !== confirmPassword) {
                alert('Пароли не совпадают');
                return;
            }

            fetch('/register', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: new URLSearchParams({
                    'username': username,
                    'password': password,
                    'secret_key': secretKey
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    document.getElementById('welcomeUser').innerText = data.username;
                    document.getElementById('userInfo').style.display = 'flex';
                    document.getElementById('overlay').style.display = 'none';
                    document.getElementById('content_window2').classList.remove('show');
                    document.getElementById('content_window2').style.display = 'none';
                    document.getElementById('loginButton').style.display = 'none';
                    document.getElementById('registerButton').style.display = 'none';
                    localStorage.setItem('username', data.username);
                } else {
                    alert(data.message);
                }
            });
        };

        // Обработчик для формы входа
        document.getElementById('loginForm').onsubmit = function(event) {
            event.preventDefault();

            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            fetch('/login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: new URLSearchParams({
                    'username': username,
                    'password': password
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    document.getElementById('welcomeUser').innerText = data.username;
                    document.getElementById('userInfo').style.display = 'flex';
                    document.getElementById('overlay').style.display = 'none';
                    document.getElementById('content_window').classList.remove('show');
                    document.getElementById('content_window').style.display = 'none';
                    document.getElementById('loginButton').style.display = 'none';
                    document.getElementById('registerButton').style.display = 'none';
                    localStorage.setItem('username', data.username);
                } else {
                    alert(data.message);
                }
            });
        };

        // Обработчик кнопки выхода
        document.querySelector('.btn-logout').addEventListener('click', function() {
            fetch('/logout', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    document.getElementById('userInfo').style.display = 'none';
                    document.getElementById('loginButton').style.display = 'block';
                    document.getElementById('registerButton').style.display = 'block';
                    localStorage.removeItem('username');
                } else {
                    alert(data.message);
                }
            });
        });

        // Проверка состояния пользователя при загрузке страницы
        window.addEventListener('load', function() {
            const username = localStorage.getItem('username');
            if (username) {
                document.getElementById('welcomeUser').innerText = username;
                document.getElementById('userInfo').style.display = 'flex';
                document.getElementById('loginButton').style.display = 'none';
                document.getElementById('registerButton').style.display = 'none';
            }
        });

        // Синхронизация состояния пользователя между вкладками
        window.addEventListener('storage', function(event) {
            if (event.key === 'username') {
                if (event.newValue) {
                    document.getElementById('welcomeUser').innerText = event.newValue;
                    document.getElementById('userInfo').style.display = 'flex';
                    document.getElementById('loginButton').style.display = 'none';
                    document.getElementById('registerButton').style.display = 'none';
                } else {
                    document.getElementById('userInfo').style.display = 'none';
                    document.getElementById('loginButton').style.display = 'block';
                    document.getElementById('registerButton').style.display = 'block';
                }
            }
        });

        // Прокрутка к категориям при клике на кнопку "Начать исследовать"
        document.querySelector('.Menu').addEventListener('click', function() {
            const categoriesSection = document.querySelector('.categories');
            categoriesSection.scrollIntoView({ behavior: 'smooth' });
        });
    </script>
</body>
</html>