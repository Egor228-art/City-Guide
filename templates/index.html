<!--–ö–æ–¥ –¥–ª—è —Å–±—Ä–æ—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞: localStorage.removeItem('authButtonsVisible'); location.reload() -->
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{title}}</title>
    <link href="{{ url_for('static', filename='css/bootstrap.min.css') }}" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/index.css') }}">
    <link rel="icon" href="{{ url_for('static', filename='–§–æ—Ç–∫–∏ –∑–¥–∞–Ω–∏–π/–ª–æ–≥–æ.png') }}" type="image/png">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <!-- –í—Å—Ç–∞–≤–ª—è–µ–º —à–∞–ø–∫—É -->
    {% include 'header.html' %}

    <main>
        <!-- –ì–µ—Ä–æ–π-—Å–µ–∫—Ü–∏—è -->
        <section class="hero">
            <div class="hero-content">
                <h1>–û—Ç–∫—Ä–æ–π—Ç–µ –¥–ª—è —Å–µ–±—è –í–µ–ª–∏–∫–∏–π –ù–æ–≤–≥–æ—Ä–æ–¥</h1>
                <p>–ù–∞–π–¥–∏—Ç–µ –ª—É—á—à–∏–µ –º–µ—Å—Ç–∞ –≥–æ—Ä–æ–¥–∞ –≤ –æ–¥–Ω–æ–º –≥–∏–¥–µ</p>
                <div class="hero-buttons">
                    <button class="btn-explore" id="openCatalogModal">–ù–∞—á–∞—Ç—å –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å</button>
                    <button class="btn-random" id="randomPlaceBtn">–°–ª—É—á–∞–π–Ω–æ–µ –∑–∞–≤–µ–¥–µ–Ω–∏–µ</button>
                </div>
            </div>
            <img src="{{ url_for('static', filename='–§–æ—Ç–∫–∏ –∑–¥–∞–Ω–∏–π/–í–µ–ª–∏–∫–∏–π–ù–æ–≤–≥–æ—Ä–æ–¥.png') }}" alt="–í–µ–ª–∏–∫–∏–π –ù–æ–≤–≥–æ—Ä–æ–¥" class="hero-image">
        </section>

        <!-- –°–µ–∫—Ü–∏—è –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –∑–∞–≤–µ–¥–µ–Ω–∏–π –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º -->
        <section class="popular-places" id="popularPlacesSection">
            <div class="scrol-container">
                <h2 class="section-title">–°–∞–º—ã–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –∑–∞–≤–µ–¥–µ–Ω–∏—è –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º</h2>

                <div class="scroller-container">
                    <div class="scroller-wrapper">
                        <!-- –ö–Ω–æ–ø–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ -->
                        <div class="scroller-nav scroller-prev" id="scrollerPrev">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>

                        <div class="popular-scroller" id="popularScroller">
                            <div class="scroller-track" id="scrollerTrack">
                                <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                            </div>
                        </div>

                        <div class="scroller-nav scroller-next" id="scrollerNext">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                <path d="M9 18L15 12L9 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∫–∞—Ç–∞–ª–æ–≥–∞ -->
    <div class="modal" id="catalogModal">
        <div class="modal-content catalog-modal">
            <span class="close-modal" id="closeCatalogModal">&times;</span>
            <h2>–ö–∞—Ç–∞–ª–æ–≥ –∑–∞–≤–µ–¥–µ–Ω–∏–π</h2>
            <div class="catalog-grid" id="catalogGrid">
                <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
        </div>
    </div>

    <!-- –í—Å—Ç–∞–≤–ª—è–µ–º –ø–æ–¥–≤–∞–ª -->
    {% include 'footer.html' %}

    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –æ–±—â–∏–π JS -->
    <script src="{{ url_for('static', filename='js/common.js') }}"></script>
    <script>

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
document.addEventListener('DOMContentLoaded', function() {
    initCatalogModal();
    loadPopularPlace();
    loadPopularPlacesByCategory();
});

// –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–∫—Ä–æ–ª–ª–µ—Ä–æ–º
let scrollerInterval;
let isScrollingPaused = false;
let currentScrollPosition = 0;
let scrollDirection = 1; // 1 –¥–ª—è –≤–ø–µ—Ä–µ–¥, -1 –¥–ª—è –Ω–∞–∑–∞–¥
let cardWidth = 0;
let maxScroll = 0;
let autoScrollEnabled = true;

function initSecretKeys() {
    console.log('üîê Initializing secret keys...');

    document.addEventListener('keydown', (e) => {
        konamiCode.push(e.code);
        console.log('Key pressed:', e.code, 'Sequence:', konamiCode);

        // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –¥–ª–∏–Ω—É –º–∞—Å—Å–∏–≤–∞
        if (konamiCode.length > secretCode.length) {
            konamiCode.shift();
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
        if (JSON.stringify(konamiCode) === JSON.stringify(secretCode)) {
            console.log('üéâ Secret code activated!');
            showAuthButtons(true);
            konamiCode = []; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º
        }
    });
}

// –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∫–∞—Ç–∞–ª–æ–≥–∞
function initCatalogModal() {
    const modal = document.getElementById('catalogModal');
    const openBtn = document.getElementById('openCatalogModal');
    const closeBtn = document.getElementById('closeCatalogModal');
    const randomBtn = document.getElementById('randomPlaceBtn');

    if (!modal || !openBtn) {
        console.error('‚ùå Catalog modal elements not found!');
        return;
    }

    openBtn.addEventListener('click', function() {
        loadCatalogCategories();
        modal.style.display = 'flex';
    });

    if (closeBtn) {
        closeBtn.addEventListener('click', function() {
            modal.style.display = 'none';
        });
    }

    if (randomBtn) {
        randomBtn.addEventListener('click', function() {
            // –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –∫–Ω–æ–ø–∫–∏ "–°–ª—É—á–∞–π–Ω–æ–µ –∑–∞–≤–µ–¥–µ–Ω–∏–µ"
            randomBtn.innerHTML = 'üåÄ –ò—â–µ–º...';
            randomBtn.style.pointerEvents = 'none';

            fetch('/api/random-place')
                .then(response => response.json())
                .then(data => {
                    if (data.success && data.place_url) {
                        window.location.href = data.place_url;
                    } else {
                        alert('–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ —Å–ª—É—á–∞–π–Ω–æ–µ –∑–∞–≤–µ–¥–µ–Ω–∏–µ');
                        randomBtn.innerHTML = '–°–ª—É—á–∞–π–Ω–æ–µ –∑–∞–≤–µ–¥–µ–Ω–∏–µ';
                        randomBtn.style.pointerEvents = 'auto';
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ —Å–ª—É—á–∞–π–Ω–æ–≥–æ –∑–∞–≤–µ–¥–µ–Ω–∏—è');
                    randomBtn.innerHTML = '–°–ª—É—á–∞–π–Ω–æ–µ –∑–∞–≤–µ–¥–µ–Ω–∏–µ';
                    randomBtn.style.pointerEvents = 'auto';
                });
        });
    }

    // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –æ–∫–Ω–∞
    window.addEventListener('click', function(e) {
        if (e.target === modal) {
            modal.style.display = 'none';
        }
    });
}

function loadCatalogCategories() {
    const catalogGrid = document.getElementById('catalogGrid');

    if (!catalogGrid) {
        console.error('‚ùå Catalog grid element not found!');
        return;
    }

    // –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
    const categories = [
        { name: '–†–µ—Å—Ç–æ—Ä–∞–Ω—ã', icon: '/static/–§–æ—Ç–∫–∏ –∑–¥–∞–Ω–∏–π/–ò–∫–æ–Ω–∫–∞–†–µ—Å—Ç–æ—Ä–∞–Ω–∞.png', url: '/restaurant' },
        { name: '–ö–∞—Ñ–µ', icon: '/static/–§–æ—Ç–∫–∏ –∑–¥–∞–Ω–∏–π/–ò–∫–æ–Ω–∫–∞–ö–æ—Ñ–µ.png', url: '/coffee' },
        { name: '–ú–∞–≥–∞–∑–∏–Ω—ã', icon: '/static/–§–æ—Ç–∫–∏ –∑–¥–∞–Ω–∏–π/–ò–∫–æ–Ω–∫–∞–ú–∞–≥–∞–∑–∏–Ω–∞.png', url: '/shop' },
        { name: '–ú—É–∑–µ–∏', icon: '/static/–§–æ—Ç–∫–∏ –∑–¥–∞–Ω–∏–π/–ò–∫–æ–Ω–∫–∞–ú—É–∑–µ–∏.png', url: '/museums' },
        { name: '–¢–µ–∞—Ç—Ä—ã', icon: '/static/–§–æ—Ç–∫–∏ –∑–¥–∞–Ω–∏–π/–ò–∫–æ–Ω–∫–∞–¢–µ–∞—Ç—Ä.png', url: '/theatre' },
        { name: '–ë–∏–±–ª–∏–æ—Ç–µ–∫–∏', icon: '/static/–§–æ—Ç–∫–∏ –∑–¥–∞–Ω–∏–π/–ò–∫–æ–Ω–∫–∏–ë–∏–±–ª–∏–æ—Ç–µ–∫–∏.png', url: '/library' },
        { name: '–ü–∞—Ä–∫–∏', icon: '/static/–§–æ—Ç–∫–∏ –∑–¥–∞–Ω–∏–π/–ò–∫–æ–Ω–∫–∞–ü–∞—Ä–∫–∞.png', url: '/park' },
        { name: '–ö–∏–Ω–æ—Ç–µ–∞—Ç—Ä—ã', icon: '/static/–§–æ—Ç–∫–∏ –∑–¥–∞–Ω–∏–π/–ò–∫–æ–Ω–∫–∞–ö–∏–Ω–æ—Ç–µ–∞—Ç—Ä.png', url: '/cinema' },
        { name: '–°–ø–æ—Ä—Ç', icon: '/static/–§–æ—Ç–∫–∏ –∑–¥–∞–Ω–∏–π/–ò–∫–æ–Ω–∫–∞–°–ø–æ—Ä—Ç–ø–ª–æ—â–∞–¥–∫–∞.png', url: '/sports' },
        { name: '–¶–µ—Ä–∫–≤–∏', icon: '/static/–§–æ—Ç–∫–∏ –∑–¥–∞–Ω–∏–π/–ò–∫–æ–Ω–∫–∞–¶–µ—Ä–∫–≤–∏.png', url: '/church' },
        { name: '–ì–æ—Å—Ç–∏–Ω–∏—Ü—ã', icon: '/static/–§–æ—Ç–∫–∏ –∑–¥–∞–Ω–∏–π/–ò–∫–æ–Ω–∫–∏–ì–æ—Å—Ç–∏–Ω–∏—Ü—ã.png', url: '/hotels' }
    ];

    catalogGrid.innerHTML = categories.map(cat => `
        <a href="${cat.url}" class="catalog-category">
            <img src="${cat.icon}" alt="${cat.name}">
        </a>
    `).join('');
}

// –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –∑–∞–≤–µ–¥–µ–Ω–∏–π –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
function loadPopularPlacesByCategory() {
    const section = document.getElementById('popularPlacesSection');
    const scrollerTrack = document.getElementById('scrollerTrack');

    if (!section || !scrollerTrack) {
        console.log('‚ÑπÔ∏è Popular places scroller not found, skipping...');
        return;
    }

    console.log('üî• Loading popular places by category...');

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
    scrollerTrack.innerHTML = '<div class="scroller-loading">–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –∑–∞–≤–µ–¥–µ–Ω–∏–π...</div>';
    section.style.display = 'block';

    fetch('/api/popular-places-by-category')
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            console.log('üìä API response:', data);

            if (data.success && data.popular_places && data.popular_places.length > 0) {
                console.log(`‚úÖ Found ${data.popular_places.length} popular places`);
                renderPopularPlacesScroller(data.popular_places);
            } else {
                console.log('‚ÑπÔ∏è No popular places found');
                scrollerTrack.innerHTML = '<div class="scroller-empty">–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∑–∞–≤–µ–¥–µ–Ω–∏—è –ø–æ—è–≤—è—Ç—Å—è –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –æ—Ç–∑—ã–≤–æ–≤</div>';
            }
        })
        .catch(error => {
            console.error('‚ùå Error loading popular places:', error);
            scrollerTrack.innerHTML = '<div class="scroller-error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –∑–∞–≤–µ–¥–µ–Ω–∏–π</div>';
        });
}

// –§—É–Ω–∫—Ü–∏—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –∫–∞—Ä—Ç–æ—á–µ–∫ –≤ —Å–∫—Ä–æ–ª–ª–µ—Ä–µ
function renderPopularPlacesScroller(popularPlaces) {
    const scrollerTrack = document.getElementById('scrollerTrack');

    // –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
    scrollerTrack.innerHTML = '';

    // –°–æ–∑–¥–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏
    popularPlaces.forEach((item, index) => {
        const card = document.createElement('div');
        card.className = 'popular-place-card';
        card.style.animationDelay = `${index * 0.1}s`;

        // –ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –±–µ–∑ –æ–±—Ä–µ–∑–∫–∏
        const fullDescription = item.place.description || '–û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç';

        // –§–û–†–ú–ê–¢–ò–†–£–ï–ú –†–ï–ô–¢–ò–ù–ì: 0.0 ‚Üí 0 –∏ –º–µ–Ω—è–µ–º –º–µ—Å—Ç–∞–º–∏ –∑–≤–µ–∑–¥—É –∏ —Ü–∏—Ñ—Ä—É
        const rating = item.place.avg_rating || 0;
        let formattedRating;
        if (rating === 0 || rating === '0' || rating === '0.0') {
            formattedRating = '0';
        } else {
            formattedRating = typeof rating === 'number' ? rating.toFixed(1) : rating;
            // –£–±–∏—Ä–∞–µ–º .0 –µ—Å–ª–∏ —Ä–µ–π—Ç–∏–Ω–≥ —Ü–µ–ª—ã–π
            if (formattedRating.endsWith('.0')) {
                formattedRating = formattedRating.replace('.0', '');
            }
        }

        card.innerHTML = `
            <div class="category-badge">${item.category}</div>
            <div class="place-image-container">
                <img src="${item.place.image_path ? '/static/' + item.place.image_path : '/static/–§–æ—Ç–∫–∏ –∑–¥–∞–Ω–∏–π/default.png'}"
                     alt="${item.place.title}"
                     class="place-image"
                     onerror="this.src='/static/–§–æ—Ç–∫–∏ –∑–¥–∞–Ω–∏–π/default.png'">
                <!-- –ü–õ–ê–®–ö–ê –° –†–ï–ô–¢–ò–ù–ì–û–ú - –ü–û–ö–ê–ó–´–í–ê–ï–ú –î–õ–Ø –í–°–ï–•, –î–ê–ñ–ï –° 0 -->
                <div class="rating-overlay">
                    <span class="rating-badge">${formattedRating}</span>
                </div>
            </div>
            <div class="place-info">
                <div>
                    <h3>${item.place.title}</h3>
                    <p class="place-description">
                        ${fullDescription}
                    </p>
                </div>
                <div class="place-contacts">
                    <div class="place-address">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                            <circle cx="12" cy="10" r="3"></circle>
                        </svg>
                        ${item.place.address || '–ê–¥—Ä–µ—Å –Ω–µ —É–∫–∞–∑–∞–Ω'}
                    </div>
                    <div class="place-telephone">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
                        </svg>
                        ${item.place.telephone || '–¢–µ–ª–µ—Ñ–æ–Ω –Ω–µ —É–∫–∞–∑–∞–Ω'}
                    </div>
                </div>
            </div>
        `;

        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞
        card.addEventListener('click', () => {
            window.location.href = item.place.url;
        });

        scrollerTrack.appendChild(card);
    });

    // –î—É–±–ª–∏—Ä—É–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏ –¥–ª—è –±–µ—Å—à–æ–≤–Ω–æ–π –∞–Ω–∏–º–∞—Ü–∏–∏
    const cards = scrollerTrack.querySelectorAll('.popular-place-card');
    cards.forEach(card => {
        const clone = card.cloneNode(true);
        scrollerTrack.appendChild(clone);
    });

    console.log('‚úÖ Popular places scroller rendered');

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∫—Ä–æ–ª–ª–µ—Ä–æ–º
    initScrollerControls();
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–∫—Ä–æ–ª–ª–µ—Ä–æ–º
function initScrollerControls() {
    const scrollerTrack = document.getElementById('scrollerTrack');
    const prevBtn = document.getElementById('scrollerPrev');
    const nextBtn = document.getElementById('scrollerNext');
    const scrollerContainer = document.querySelector('.scroller-container');

    if (!scrollerTrack || !prevBtn || !nextBtn || !scrollerContainer) {
        console.error('‚ùå Scroller elements not found');
        return;
    }

    let isManualMode = false;
    let manualScrollPosition = 0;
    const cardWidth = 500 + 32; // 500px (—à–∏—Ä–∏–Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–∏) + 32px (gap)

    // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º –≤ —Ä—É—á–Ω–æ–π —Ä–µ–∂–∏–º –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –∫–Ω–æ–ø–æ–∫
    function enableManualMode() {
        if (!isManualMode) {
            isManualMode = true;
            scrollerTrack.classList.add('manual-control');
            scrollerTrack.style.animationPlayState = 'paused';
            manualScrollPosition = 0;
            updateManualScrollPosition();
        }
    }

    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –≤ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∂–∏–º
    function enableAutoMode() {
        if (isManualMode) {
            isManualMode = false;
            scrollerTrack.classList.remove('manual-control');
            scrollerTrack.style.animationPlayState = 'running';
            scrollerTrack.style.transform = 'translateX(0)';
        }
    }

    // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é –≤ —Ä—É—á–Ω–æ–º —Ä–µ–∂–∏–º–µ
    function updateManualScrollPosition() {
        scrollerTrack.style.transform = `translateX(-${manualScrollPosition}px)`;
    }

    // –ö–Ω–æ–ø–∫–∞ "–Ω–∞–∑–∞–¥"
    prevBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        e.preventDefault();

        console.log('‚¨ÖÔ∏è Previous button clicked');
        enableManualMode();

        const trackWidth = scrollerTrack.scrollWidth / 2; // –¢.–∫. –∫–∞—Ä—Ç–æ—á–∫–∏ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω—ã
        manualScrollPosition -= cardWidth;

        // –ï—Å–ª–∏ –≤—ã—à–ª–∏ –∑–∞ –Ω–∞—á–∞–ª–æ, –ø–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –∫–æ–Ω–µ—Ü
        if (manualScrollPosition < 0) {
            manualScrollPosition = trackWidth - cardWidth;
        }

        updateManualScrollPosition();
    });

    // –ö–Ω–æ–ø–∫–∞ "–≤–ø–µ—Ä–µ–¥"
    nextBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        e.preventDefault();

        console.log('‚û°Ô∏è Next button clicked');
        enableManualMode();

        const trackWidth = scrollerTrack.scrollWidth / 2;
        manualScrollPosition += cardWidth;

        // –ï—Å–ª–∏ –≤—ã—à–ª–∏ –∑–∞ –∫–æ–Ω–µ—Ü, –ø–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –Ω–∞—á–∞–ª–æ
        if (manualScrollPosition >= trackWidth) {
            manualScrollPosition = 0;
        }

        updateManualScrollPosition();
    });

    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –≤ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∂–∏–º —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥ –±–µ–∑–¥–µ–π—Å—Ç–≤–∏—è
    let autoModeTimeout;
    function resetAutoModeTimeout() {
        clearTimeout(autoModeTimeout);
        autoModeTimeout = setTimeout(() => {
            if (isManualMode) {
                enableAutoMode();
                console.log('üîÑ Returning to auto-scroll mode');
            }
        }, 5000);
    }

    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ç–∞–π–º–µ—Ä –ø—Ä–∏ –ª—é–±–æ–º –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–∏
    [prevBtn, nextBtn].forEach(btn => {
        btn.addEventListener('click', resetAutoModeTimeout);
    });

    // –ü–∞—É–∑–∞ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ (—Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –æ–±–æ–∏—Ö —Ä–µ–∂–∏–º–∞—Ö)
    scrollerContainer.addEventListener('mouseenter', () => {
        scrollerTrack.style.animationPlayState = 'paused';
    });

    scrollerContainer.addEventListener('mouseleave', () => {
        if (!isManualMode) {
            scrollerTrack.style.animationPlayState = 'running';
        }
    });

    console.log('‚úÖ Scroller controls initialized - both auto and manual modes available');
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ø—É–ª—è—Ä–Ω–æ–≥–æ –∑–∞–≤–µ–¥–µ–Ω–∏—è
function loadPopularPlace() {
    const section = document.getElementById('popularPlaceSection');
    const card = document.getElementById('popularPlaceCard');

    if (!section || !card) {
        return;
    }

    fetch('/api/popular-place')
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            if (data.success && data.place) {
                // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –æ–ø–∏—Å–∞–Ω–∏–µ (–æ–±—Ä–µ–∑–∞–µ–º –µ—Å–ª–∏ —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω–æ–µ)
                let description = data.place.description || '–û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç';
                if (description.length > 150) {
                    description = description.substring(0, 150) + '...';
                }

                card.innerHTML = `
                    <div class="image-wrapper">
                        <img class="restaurant-image"
                             src="${data.place.image_path ? '/static/' + data.place.image_path : '/static/–§–æ—Ç–∫–∏ –∑–¥–∞–Ω–∏–π/default.png'}"
                             alt="${data.place.title}">
                        <div class="rating-overlay">
                            <span class="rating-badge">${data.place.avg_rating.toFixed(1)}</span>
                        </div>
                    </div>

                    <div class="restaurant-info">
                        <h3 class="restaurant-name">${data.place.title}</h3>

                        <p class="restaurant-description">
                            ${description}
                            ${data.place.review_count > 0 ? `` : ''}
                        </p>

                        <div class="restaurant-contacts">
                            <div>
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
                                </svg>
                                <span>${data.place.telephone || '–¢–µ–ª–µ—Ñ–æ–Ω –Ω–µ —É–∫–∞–∑–∞–Ω'}</span>
                            </div>
                            <div class="metka">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                                    <circle cx="12" cy="10" r="3"></circle>
                                </svg>
                                <span>${data.place.address || '–ê–¥—Ä–µ—Å –Ω–µ —É–∫–∞–∑–∞–Ω'}</span>
                            </div>
                        </div>
                    </div>
                `;

                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞
                card.onclick = function() {
                    window.location.href = data.place.url;
                };

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–µ–∫—Ü–∏—é —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π
                section.style.display = 'block';
                setTimeout(() => {
                    card.style.opacity = '1';
                }, 100);
            }
        })
        .catch(error => {
            console.error('‚ùå Error loading popular place:', error);
        });
}
    </script>
</body>
</html>